$(document).ready( function () {
  var namatable =$('#namatable').val();
  var table = '<table id="example2" class="table table-bordered table-hover hover" style="width:100%;background-color:#90CAF9 !important"><thead><tr>';
  var divform = '<div class="form-group">';
  var tablenya = '';
  $.ajax({
        type: "POST",
        header:{
           'X-CSRF-TOKEN':$('#token').val()
         },
        url: "/ambildata",
          dataType: "json",
        data:{
          "_token":$('#token').val(),
          "table": namatable
        },
        success: function (response) {
          $.each(response.columns, function(key, value) {
           table += "<th>"+value+"</th>";
         });
         table += "</tr></thead><tbody>";
         table += "</tr></thead><tbody>";
        $.each(response.data, function(key, row) {
            table += "<tr>";
            $.each(row, function(key, fieldValue) {
                table += "<td>"+fieldValue+"</td>";
            });
            table += "</tr>";
        });
        table += '<tbody></table>';
        $('#datad').html(table);
        tablenya = $('#example2').DataTable({
          dom: "Bfrtip",
    aaData: response.data,
    columns: response.columns
         //  "processing": false,
         //  "serverSide": false,
         //   "scrollX": true,
         //   'columnDefs': [ {
         //    'targets': [0,1],
         //    'orderable': false,
         // }],
         // dom: "Bfrtip",
         //  'aaData' : response.data
        });
        },
      });
              $('#example2').DataTable().ajax.reload()





      $('#example').on( 'order.dt',  function () {
        alert('po');
        let order = tablenya.order();
        console.log("Ordered column " + order[0][0] + ", in direction " + order[0][1]);
      } );


  $('#formdepartement').on('keyup keypress', function(e) {
  var keyCode = e.keyCode || e.which;
  if (keyCode === 13) {
    e.preventDefault();
    return false;
  }
});

  $("#from-departement").hide();
  $("#tool-kedua").hide();
  $("#tool-ketiga").hide();
  $("#divsucces").hide();
  $('.datepicker').datepicker({
    format: 'd-m-yyyy'
    // startDate: '-3d'
  });
});

$("#savedata").click(function(e){
e.preventDefault();
var kode = $("#kode").val();
var nama = $("#nama").val();
var namatable =$('#namatable').val();
// if (kode == '') {
//   alert('Kode Tidak Boleh Kosong');
//   return false;
// }
// if (nama == '') {
//   alert('Nama Tidak Boleh Kosong');
//   return false;
// }
var formdata = $("#formdepartement").serialize();
$.ajax({
      type: "POST",
      header:{
         'X-CSRF-TOKEN':$('#token').val()
       },
      url: "/savedata",
      dataType: "json",
      data:{
         "_token":$('#token').val(),
        "data" :{
            'data' : formdata,
            'tabel': namatable
        }
      },
      success:function(result){
        if (result.status == 'add') {
                              $("#notiftext").text('Data  Berhasil di Tambah');
        }else{
                                                  $("#notiftext").text('Data  Berhasil di Edit');
        }

        document.getElementById("formdepartement").reset();
        $("#example").dataTable()._fnAjaxUpdate();
        $('#divsucces').show(0).delay(5000).hide(0);
        var x = document.getElementById("from-departement");
        var x2 = document.getElementById("tabledepartemen");
        var y = document.getElementById("tool-kedua");
        var y2 = document.getElementById("tool-pertama");
          x.style.display = "none";
          x2.style.display = "block";
          y.style.display = "none";
          y2.style.display = "block";

}});
});

function AddData() {
  var x = document.getElementById("from-departement");
  var x2 = document.getElementById("tabledepartemen");
  var y = document.getElementById("tool-kedua");
  var y2 = document.getElementById("tool-pertama");
    if (x.style.display === "none") {
      x.style.display = "block";
      x2.style.display = "none";
      y.style.display = "block";
      y2.style.display = "none";
    } else {
      x.style.display = "none";
      x2.style.display = "block";
    }
}

function CancelData() {
  var x = document.getElementById("from-departement");
  var x2 = document.getElementById("tabledepartemen");
  var y = document.getElementById("tool-kedua");
  var y2 = document.getElementById("tool-pertama");
  var y3 = document.getElementById("tool-ketiga");
    x.style.display = "none";
    x2.style.display = "block";
    y.style.display = "none";
    y2.style.display = "block";
    y3.style.display = "none";
                      document.getElementById("formdepartement").reset();
}

function viewDepartemen(id) {
  var x = document.getElementById("from-departement");
  var x2 = document.getElementById("tabledepartemen");
  var y = document.getElementById("tool-kedua");
  var y2 = document.getElementById("tool-pertama");
  var y3 = document.getElementById("tool-ketiga");
    if (x.style.display === "none") {
      x.style.display = "block";
      x2.style.display = "none";
      y.style.display = "none";
      y2.style.display = "none";
      y3.style.display = "block";
    } else {
      x.style.display = "none";
      x2.style.display = "block";
    }
    $.ajax({
        url: '/editdepartemen',
        type: "POST",
        dataType: 'json',
        header:{
           'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')
         },
        data: {
          "id" : id,
          "namatable" : $("#namatable").val(),
          "_token": "{{ csrf_token() }}",
        },
        success: function (data) {
          $("#noid").val(data.noid);
          $("#kode").val(data.kode);
          $("#nama").val(data.nama);
          $("#namaalias").val(data.namaalias);
          $("#keterangan").val(data.keterangan);
          $('#idcompany option[value="'+data.company+'"]').prop('selected', true);
          $('#isactive').find(':radio[name=isactive][value="'+data.isactive+'"]').prop('checked', true);
          $('#issystem').find(':radio[name=issystem][value="'+data.issystem+'"]').prop('checked', true);
          $("#idparent").val(data.idparent);
          $("#depthlevel").val(data.depthlevel);
          $("#classicon").val(data.classicon);
          $("#classcolor").val(data.classcolor);
          $("#idcreate").val(data.idcreate);
          $("#docreate").val(data.docreate);
          $("#idupdate").val(data.idupdate);
          $("#lastupdate").val(data.lastupdate);
        },

    });
}
function editDepartemen(id) {
  var x = document.getElementById("from-departement");
  var x2 = document.getElementById("tabledepartemen");
  var y = document.getElementById("tool-kedua");
  var y2 = document.getElementById("tool-pertama");
  if (x.style.display === "none") {
    x.style.display = "block";
    x2.style.display = "none";
    y.style.display = "block";
    y2.style.display = "none";
  } else {
    x.style.display = "none";
    x2.style.display = "block";
  }
  $.ajax({
      url: '/editdepartemen',
      type: "POST",
      dataType: 'json',
      header:{
         'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')
       },
      data: {
        "id" : id,
        "namatable" : $("#namatable").val(),
        "_token": "{{ csrf_token() }}",
      },
      success: function (data) {
        $("#noid").val(data.noid);
        $("#kode").val(data.kode);
        $("#nama").val(data.nama);
        $("#namaalias").val(data.namaalias);
        $("#keterangan").val(data.keterangan);
        $('#isactive').find(':radio[name=isactive][value="'+data.isactive+'"]').prop('checked', true);
        $('#issystem').find(':radio[name=issystem][value="'+data.issystem+'"]').prop('checked', true);
        $("#idparent").val(data.idparent);
        $("#depthlevel").val(data.depthlevel);
        $("#classicon").val(data.classicon);
        $("#classcolor").val(data.classcolor);
        $("#idcreate").val(data.idcreate);
        $("#docreate").val(data.docreate);
        $("#idupdate").val(data.idupdate);
        $("#lastupdate").val(data.lastupdate);
      }
  });

}

function hapusDepartemen(id) {
  if (confirm('Are you sure you want to delete this?')) {
      $.ajax({
          url: '/hapusdepartemen',
          type: "POST",
          header:{
             'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')
           },
          data: {
            "id" : id,
            "namatable" :  $("#namatable").val(),
            "_token": "{{ csrf_token() }}",
          },
          success: function () {
                  $("#notiftext").text('Data Company Berhasil di hapus');
                  $("#example").dataTable()._fnAjaxUpdate();
                  $('#divsucces').show(0).delay(5000).hide(0);
                  var x = document.getElementById("from-departement");
                  var x2 = document.getElementById("tabledepartemen");
                  var y = document.getElementById("tool-kedua");
                  var y2 = document.getElementById("tool-pertama");
                    x.style.display = "none";
                    x2.style.display = "block";
                    y.style.display = "none";
                    y2.style.display = "block";
          }
      });
  }
}
